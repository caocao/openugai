<html>
<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>Index</title>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/mylib.js"></script>
</head>
<body>

<a href="/index.html">INDEX</a>
<hr>

<h3>Contents</h3>
<div id="contents_list">
Loading ...
</div>

<h3>Live Regions</h3>
<div id="region_list">
Loading ...
</div>

<script type="text/javascript">
var gAPIURL = "http://openugai.wolfdrawer.net/grid2.cgi";
var gWebURL = "http://openugai.wolfdrawer.net/space.cgi";

$(document).ready(function() {
  LoadContents();
  LoadRegions();
});

function LoadRegions() {
  var url = gAPIURL + "/region/list";
  $.ajax({
    type: "GET",
    contentType: "text/plain",
    url: url,
    dataType: 'json',
    success: function(data) {
      var html = "";
      if (data.count == 0) {
        html = "no Live Region";
      } else {
        html = "<ul>";
        for(var i in data.list) {
          html += _makeRegionItem(data.list[i]);
        }
        html += "</ul>";
      }
      $('#region_list').html(html);
    }
  });  
}

function _makeRegionItem(data) {
  var url_region_page = gWebURL + "/region/info/" + data.client_uuid;
  var url_viewer_page = gWebURL + "/join/" + data.client_uuid;
  var html = '<li>';
  html += '<a href="' + url_region_page + '">' + data.ip_addr + ":" + data.udp_port + '</a>';
  html += ' | ';
  html += '<a href="' + url_viewer_page + '">Join</a>';
  html += '</li>';
  return html;
}

function LoadContents() {
  var url = gAPIURL + "/contents/list";
  $.ajax({
    type: "GET",
    contentType: "text/plain",
    url: url,
    dataType: 'json',
    success: function(data) {
      var html = "";
      for(var i in data.list) {
        html += _makeContentsItem(data.list[i]);
      }
      $('#contents_list').html(html);
    }
  });
}

function _makeContentsItem(contents) {
  var url = gWebURL + "/contents/info/" + contents.id;
  var html = '<ul><a href="' + url + '">' + contents.name + '</a>';
  html += '<li>Description: ' + contents.desc + '</li>';  
  html += '<li><a href="' + contents.url + '">' + contents.url + '</a></li>';  
  for(var i in contents.data) {
    html += _makeContentsDataInfo(contents.data[i]);
  }
  html += "</ul>";
  return html;
}

function _makeContentsDataInfo(data) {
  var url = gAPIURL + "/contents/data/" + data.id;
  var html = '<ul>';
  html += '<li>Size: ' + data.size + ' ';  
  html += '<a href="' + url + '">Quick start</a></li>';  
  html += '</ul>';
  return html;
}

</script>

<script type="text/javascript">

</script>

</body>
</html>
